# 工数管理アプリケーション 要求仕様書

## 1. システム概要

本システムは、複数ユーザーが作業工数を入力・管理・集計できるWebアプリケーションである。
直感的なカレンダーUIを使用し、ドラッグ&ドロップによる工数入力を可能とする。

## 2. 機能要件

### 2.1 ユーザー管理機能
- **ユーザー登録・選択機能**
  - 複数のユーザーを事前登録可能
  - アクセス時にユーザーを選択（ログイン機能なし・性善説ベース）
  - ユーザー一覧・詳細表示・削除機能
  - 動的ユーザー選択機能（全画面でのユーザー選択対応）
  - 将来的にログイン機能の追加を想定した設計とする

### 2.2 プロジェクト・分類・タスク管理機能
- **プロジェクト管理**
  - プロジェクト名の登録・編集・削除
  - カラーピッカー機能によるプロジェクト色設定
  - プロジェクト一覧・検索・ソート機能
  - 削除されたプロジェクトでも過去の工数データは保持
- **分類管理**
  - 分類（仕様工程、設計工程など）の登録・編集・削除
  - プリセットカラー及びカスタムカラー対応
  - 分類一覧・検索・ソート機能
  - 削除された分類でも過去の工数データは保持
  - **分類はプロジェクト横断で使用可能**（多対多の関係）
- **タスク管理**
  - タスク名称・説明の登録・編集・削除
  - **タスクは特定のプロジェクトに属する**（プロジェクト配下の管理）
  - プロジェクトフィルタリング機能
  - プロジェクト連動タスク作成機能
  - タスク説明の改行表示対応
  - 各ユーザーが独自にプロジェクト・分類・タスクを作成可能
- **関係性**
  - プロジェクト ← 1:N → タスク（タスクは特定プロジェクトに属する）
  - 分類は全プロジェクトで共有可能（プロジェクト横断）
  - 工数入力時に「プロジェクト→タスク」と「分類」を独立選択

### 2.3 工数入力機能
- **カレンダーUI**
  - 週表示形式のカレンダー
  - 15分刻みのタイムスロット
  - 24時間（0:00-23:59）対応
- **工数入力方法**
  - ドラッグ&ドロップによる工数入力（Googleカレンダー風）
  - **2段階選択方式**：
    1. プロジェクト選択 → タスク選択
    2. 分類選択（プロジェクト横断で利用可能）
  - 選択したタスクと分類の組み合わせを時間帯にドロップして工数登録
  - 15分単位での工数入力
- **入力制限**
  - 同じ時間帯には1つのタスクのみ入力可能
  - 時間の重複を防ぐバリデーション機能
  - 確認ダイアログによるユーザーフィードバック
- **編集機能**
  - 入力済み工数の修正・削除が可能
  - ドラッグによる時間変更・リサイズ機能
  - 詳細表示と確認削除機能

### 2.4 工数集計・表示機能
- **集計期間指定**
  - 今月
  - 先月
  - 過去30日
  - カスタム期間（開始日〜終了日を指定）
- **集計軸**
  - プロジェクトごとの工数集計
  - 分類ごとの工数集計
  - 日別工数集計
  - 工数詳細データ表示（フィルタリング対応）
  - ユーザー別集計（動的ユーザー選択対応）
- **表示機能**
  - 集計結果の一覧表示
  - タブ式統合レポートUI
  - カラーバッジによる視覚的表現（プロジェクト・分類色表示）
  - ローディング状態・エラーハンドリング
  - グラフィカルな表示（グラフ・チャート）

## 3. 非機能要件

### 3.1 アーキテクチャ要件
- **Clean Architecture** の採用
- **TDD（テスト駆動開発）** の実践（t-wada準拠）
- **「良いコード/悪いコード」の原則** に基づく実装

### 3.2 コーディング規約
- **アーリーリターンの積極活用**
  - ネストを深くしない
  - 条件分岐では早期リターンを使用
  - ガード句の活用
- **マジックナンバー・ハードコーディングの禁止**
  - 数値は定数として定義
  - 文字列リテラルは定数として管理
  - 設定値は環境変数または設定ファイルで管理
- **型安全性の確保**
  - TypeScriptのany型の使用禁止
  - 適切な型定義の必須化
  - unknown型の適切な活用
- **関数・メソッドの設計原則**
  - 単一責任の原則（SRP）の徹底
  - 純粋関数の活用（副作用の最小化）
  - 関数は20行以内を目安とする
  - 引数は3つ以内を推奨
- **エラーハンドリング**
  - 例外は適切にキャッチし、適切なエラーメッセージを提供
  - try-catch文の適切な使用
  - カスタム例外クラスの活用
- **パフォーマンス考慮**
  - 不要な再レンダリングの防止（React.memo、useMemo活用）
  - データベースクエリの最適化
  - 適切なインデックス活用
- **可読性・保守性**
  - 自己文書化コードの作成
  - 意図が伝わる変数名・関数名の使用
  - 複雑なロジックには適切なコメント
  - デッドコードの除去

### 3.3 技術要件
- **フロントエンド**
  - React 18+ + TypeScript を使用
  - React Bootstrap 5 を使用したモダンUI
  - react-big-calendar によるカレンダーUI
  - React Router による SPA 対応
  - Context API + useReducer による状態管理
  - `front` ディレクトリに配置
- **バックエンド**
  - Node.js/Express + TypeScript で実装
  - Clean Architecture 適用
  - Prisma ORM によるデータアクセス
  - CORS・Helmet によるセキュリティ対応
  - `server` ディレクトリに配置
- **データベース**
  - Supabase（PostgreSQL）を使用
  - 論理削除・インデックス設計
  - 15分刻み制約・時間重複防止制約

### 3.4 品質要件
- **可用性**: 通常時間帯での安定稼働
- **レスポンシブ対応**: PC・タブレット・スマートフォン対応
- **データ整合性**: 工数データの正確性保証
- **将来拡張性**: ログイン機能等の追加を考慮した設計

## 4. 制約事項

### 4.1 現在の制約
- ログイン機能なし（ユーザー選択のみ）
- データエクスポート機能なし（今後実装予定）
- 承認・ワークフロー機能なし
- グラフ・チャート表示機能なし（今後実装予定）

### 4.2 将来対応予定
- ログイン認証機能（Supabase Auth対応済み設計）
- 権限管理機能（RLS対応済み設計）
- データエクスポート機能（CSV/Excel/JSON形式）
- 通知機能（工数入力リマインダー等）

## 5. 画面遷移
1. **ユーザー選択画面** → 工数入力画面
2. **工数入力画面**（メイン画面）
   - カレンダー表示（react-big-calendar使用）
   - **2段階選択UI**
     - プロジェクト選択 → タスク選択パネル
     - 分類選択パネル（プロジェクト横断）
3. **レポート・集計画面**
   - 期間・集計軸選択
   - タブ式UI（プロジェクト別・分類別・日別・詳細）
   - 動的ユーザー選択対応
4. **管理画面**
   - タブ式統合管理コンソール
   - CRUD操作（作成・詳細表示・削除）
   - 検索・ソート・フィルタリング機能
5. **ナビゲーション**
   - React Bootstrap Navbar による統合ナビゲーション
   - アクティブページ表示機能

## 6. データ保持要件
- プロジェクト・分類・タスクが削除されても、過去の工数データは削除されない（論理削除）
- 削除されたエンティティは「削除済み」として管理し、集計時は「削除済み」として表示
- `deleted_at` カラムによる論理削除機能
- データベース制約による整合性保証（15分刻み、時間重複防止等）

